<!DOCTYPE html>
<html lang="fr">
<head>
    <link rel="manifest" href="manifest.json">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ma Bibliothèque PDF</title>
    <link rel="manifest" href="manifest.json">
    <style>
        body { margin: 0; font-family: sans-serif; background-color: #333; color: white; display: flex; flex-direction: column; height: 100vh; }
        
        /* Menu de sélection */
        .menu { padding: 15px; background: #222; overflow-x: auto; white-space: nowrap; border-bottom: 2px solid #555; }
        button { background: #555; color: white; border: none; padding: 10px 15px; margin-right: 10px; border-radius: 5px; cursor: pointer; }
        button:hover { background: #007bff; }
        button.active { background: #007bff; font-weight: bold; }

        /* Affichage du PDF */
        #pdf-render { width: 100%; max-width: 800px; margin: auto; display: block; }
        .canvas-container { flex-grow: 1; overflow-y: auto; padding: 10px; }
    </style>
</head>
<body>

    <div style="padding: 10px; background: #222;">
    <input type="text" id="bookSearch" placeholder="Rechercher un livre..." 
           style="width: 100%; padding: 10px; border-radius: 5px; border: none; background: #444; color: white;">
    </div>
    
    <div class="menu">
        <button onclick="changeBook('livre1.pdf', this)" class="active">Livre 1</button>
        <button onclick="changeBook('livre2.pdf', this)">Livre 2</button>
        <button onclick="changeBook('livre3.pdf', this)">Livre 3</button>
        <button onclick="changeBook('livre4.pdf', this)">Livre 4</button>
        <button onclick="changeBook('livre5.pdf', this)">Livre 5</button>
        <button onclick="changeBook('livre6.pdf', this)">Livre 6</button>
    </div>

    <div class="canvas-container">
        <canvas id="pdf-render"></canvas>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script>
        let pdfDoc = null,
    pageNum = 1,
    pageIsRendering = false,
    pageNumPending = null,
    canvas = document.querySelector('#pdf-render'),
    ctx = canvas.getContext('2d');

function renderPage(num) {
    pageIsRendering = true;
    pdfDoc.getPage(num).then(page => {
        const viewport = page.getViewport({ scale: canvas.parentElement.clientWidth / page.getViewport({scale: 1.0}).width });
        canvas.height = viewport.height;
        canvas.width = viewport.width;

        const renderCtx = { canvasContext: ctx, viewport: viewport };
        page.render(renderCtx).promise.then(() => {
            pageIsRendering = false;
            if (pageNumPending !== null) {
                renderPage(pageNumPending);
                pageNumPending = null;
            }
        });

        // Mise à jour du compteur de pages
        document.getElementById('page-num').textContent = num;
    });
}

function queueRenderPage(num) {
    if (pageIsRendering) {
        pageNumPending = num;
    } else {
        renderPage(num);
    }
}

function onPrevPage() {
    if (pageNum <= 1) return;
    pageNum--;
    queueRenderPage(pageNum);
}

function onNextPage() {
    if (pageNum >= pdfDoc.numPages) return;
    pageNum++;
    queueRenderPage(pageNum);
}

function loadPDF(url) {
    pdfjsLib.getDocument(url).promise.then(pdfDoc_ => {
        pdfDoc = pdfDoc_;
        document.getElementById('page-count').textContent = pdfDoc.numPages;
        pageNum = 1; // Réinitialiser à la page 1 pour un nouveau livre
        renderPage(pageNum);
      });
     }
    </script>
    <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js')
        .then(reg => console.log('Service Worker enregistré !'))
        .catch(err => console.log('Erreur SW:', err));
       });
      }
     </script>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js')
        .then(reg => console.log('Service Worker enregistré !'))
        .catch(err => console.log('Erreur SW:', err));
       });
      }
     </script>


</body>
</html>
